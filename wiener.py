'''
Created on May 10, 2016

@author: edaravig

'''


from Cryptography.cont_fractions import *
from Cryptography.fast import *
import numpy as np

def wiener(e, N):
    
    cont = continued_fraction(e, N)
    conv = convergents(cont)
    
    for i in range(1,len(conv)):

        a = float(e * conv[i].denominator - 1)
        b = float(conv[i].numerator)
        c = float(a/b) * float(b)
        
        phi = float(e * conv[i].denominator - 1)/float(conv[i].numerator)
        phi = int(phi)
        print phi
        if(type(phi) is int):
        
            pol = [1, -(N-phi+1), N]
            x = np.roots(pol)
            x0 = int(x[0])
            x1 = int(x[1])
            print x, x0, x1, conv[i].denominator
            
            if((type(x[0]) is int) and (type(x[0]) is int)):
                return conv[i].denominator


def decode(C, d, N):
    
    out = ""
    
    for ch in C:
        enc = fast_original(ch, d, N)
        out += chr(enc)
    
    return out
    

if __name__ == '__main__':
    
    C = [47406263192693509,51065178201172223,30260565235128704,82385963334404268,
         8169156663927929,47406263192693509,178275977336696442,134434295894803806,
         112111571835512307,119391151761050882,30260565235128704,82385963334404268,
         134434295894803806,47406263192693509,45815320972560202,174632229312041248,
         30260565235128704,47406263192693509,119391151761050882,57208077766585306,
         134434295894803806,47406263192693509,119391151761050882,47406263192693509,
         112111571835512307,52882851026072507,119391151761050882,57208077766585306,
         119391151761050882,112111571835512307,8169156663927929,134434295894803806,
         57208077766585306,47406263192693509,185582105275050932,174632229312041248,
         134434295894803806,82385963334404268,172565386393443624,106356501893546401,
         8169156663927929,47406263192693509,10361059720610816,134434295894803806,
         119391151761050882,172565386393443624,47406263192693509,8169156663927929,
         52882851026072507,119391151761050882,8169156663927929,47406263192693509,
         45815320972560202,174632229312041248,30260565235128704,47406263192693509,
         52882851026072507,119391151761050882,111523408212481879,134434295894803806,
         47406263192693509,112111571835512307,52882851026072507,119391151761050882,
         57208077766585306,119391151761050882,112111571835512307,8169156663927929,
         134434295894803806,57208077766585306]
    
    N = 194749497518847283
    e = 50736902528669041
    
    d = wiener(e, N)
    d = 20881
    
    msg = decode(C, d, N)
    
    print(msg)
    